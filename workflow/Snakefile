# Import packages
from os.path import join
from astropy.io import fits

# Names of fields
fields = fits.open('FIELDS/fields.fits')

# List of RATE files
rate = {
    f.name: [
        join('FIELDS', f.name, 'RATE', r.replace('uncal', 'rate'))
        for r in f.data['filename'].tolist()
    ]
    for f in fields[1:]
}

# Final Rule
logs = ['fmap']
rule all:
    input:
        expand('FIELDS/{field}/logs/{log}.log',field=rate.keys(),log=logs)

# Include rules
include: "rules/download.smk"
include: "rules/stage1.smk"
include: "rules/preprocess.smk"
include: "rules/mosaic.smk"
include: "rules/contamination.smk"
include: "rules/extract.smk"
include: "rules/redshiftFit.smk"
include: "rules/makeFitsmap.smk"